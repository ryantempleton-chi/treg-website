<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Seller Net Proceeds Calculator | Templeton Real Estate Group</title>
  <meta name="description" content="Estimate seller closing costs and net proceeds in Chicago and surrounding suburbs, including transfer taxes, prorations, and commissions." />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts (site standard) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@600;700&family=Oswald:wght@400;500&family=PT+Serif:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet" />

  <!-- Global CSS -->
  <link rel="stylesheet" href="/assets/css/style.css" />

  <!-- Page-only CSS (namespaced; avoids global conflicts) -->
  <style>
    .calc-page .hero-title { text-transform: lowercase; }

    .calc-grid {
      display: grid;
      gap: 1.25rem;
      margin-top: 1.25rem;
    }
    @media (min-width: 900px) {
      .calc-grid { grid-template-columns: 1.05fr 0.95fr; }
    }

    .calc-card {
      border: 1px solid rgba(0, 0, 0, 0.06);
      background: #fff;
      border-radius: 16px;
      padding: 1.1rem;
    }

    .calc-card h2 {
      font-family: "Oswald", system-ui, sans-serif;
      font-size: 1.05rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin: 0 0 0.85rem;
    }

    .calc-form {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.85rem;
    }
    @media (min-width: 560px) {
      .calc-form { grid-template-columns: 1fr 1fr; }
      .calc-span-2 { grid-column: 1 / -1; }
    }

    .calc-field label {
      display: block;
      font-family: "Roboto", system-ui, sans-serif;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--treg-slate);
      margin-bottom: 0.45rem;
    }

    .calc-field input,
    .calc-field select {
      width: 100%;
      border: 1px solid rgba(0, 0, 0, 0.14);
      border-radius: 14px;
      padding: 0.75rem 0.85rem;
      font-family: "Roboto", system-ui, sans-serif;
      font-size: 0.95rem;
      background: #fff;
      color: var(--treg-charcoal);
    }

    .calc-field input[readonly] {
      background: rgba(250, 250, 250, 0.9);
    }

    .calc-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      margin-top: 0.35rem;
    }

    .calc-actions .btn { pointer-events: auto; }

    .calc-results {
      display: grid;
      gap: 0.75rem;
    }

    .calc-kpi {
      border-radius: 16px;
      border: 1px solid rgba(0, 0, 0, 0.06);
      background: rgba(250, 250, 250, 0.75);
      padding: 0.95rem 1rem;
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      align-items: baseline;
    }

    .calc-kpi strong {
      font-family: "Roboto", system-ui, sans-serif;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--treg-slate);
      font-weight: 600;
    }

    .calc-kpi span {
      font-family: "League Spartan", system-ui, sans-serif;
      font-weight: 700;
      font-size: 1.15rem;
      color: var(--treg-charcoal);
      white-space: nowrap;
    }

    .calc-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.75rem;
    }
    .calc-table th,
    .calc-table td {
      text-align: left;
      padding: 0.7rem 0.5rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      font-family: "Roboto", system-ui, sans-serif;
      font-size: 0.92rem;
    }
    .calc-table th {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--treg-slate);
    }
    .calc-table td:last-child { text-align: right; white-space: nowrap; }

    .calc-disclaimer {
      margin-top: 0.95rem;
      color: var(--treg-slate);
      font-size: 0.85rem;
      line-height: 1.55;
    }

    /* Auto-calculated rows: hidden until relevant */
    .calc-auto-row {
      display: none;
      opacity: 0;
      transition: opacity 180ms ease;
    }
    .calc-auto-row.is-visible {
      display: block;
      opacity: 1;
    }

    /* Simple accordion */
    details.calc-accordion {
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 16px;
      padding: 0.75rem 0.85rem;
      background: rgba(250, 250, 250, 0.6);
    }
    details.calc-accordion summary {
      cursor: pointer;
      list-style: none;
      font-family: "Roboto", system-ui, sans-serif;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--treg-slate);
      user-select: none;
    }
    details.calc-accordion summary::-webkit-details-marker { display: none; }
    .accordion-body {
      margin-top: 0.85rem;
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.85rem;
    }
    @media (min-width: 560px) {
      .accordion-body { grid-template-columns: 1fr 1fr; }
      .accordion-span-2 { grid-column: 1 / -1; }
    }

    .calc-help {
      margin-top: 0.35rem;
      font-family: "PT Serif", serif;
      font-size: 0.95rem;
      color: var(--treg-slate);
      line-height: 1.55;
    }
  </style>
</head>

<body class="calc-page">
  <div class="page">

    <!-- HEADER (exact) -->
    <header class="site-header">
      <div class="container header-inner">
        <!-- Logo -->
        <a href="/" class="logo-link">
          <img
            src="/assets/img/logo-transparent-lg.png"
            alt="ryantempleton. chicago · templeton real estate group"
            class="logo-img"
          />
        </a>

        <!-- SERHANT-style Menu button -->
        <button
          class="menu-btn"
          type="button"
          aria-label="Open menu"
          aria-haspopup="dialog"
          aria-expanded="false"
        >
          <span class="menu-btn-icon" aria-hidden="true"><span></span></span>
          menu
        </button>

        <!-- Primary navigation -->
        <nav class="nav" aria-label="Primary navigation">
          <ul class="nav-list">
            <li class="nav-item"><a href="/" class="nav-link">home</a></li>

            <li class="nav-item has-dropdown">
              <button class="nav-link-dropdown" type="button">about</button>
              <ul class="nav-dropdown">
                <li><a class="nav-dropdown-link" href="/about.html">our story</a></li>
                <li><a class="nav-dropdown-link" href="/team/">meet the team</a></li>
                <li><a class="nav-dropdown-link" href="/reviews.html">client reviews</a></li>
                <li><a class="nav-dropdown-link" href="/partners.html">partners</a></li>
              </ul>
            </li>

            <li class="nav-item has-dropdown">
              <a href="#" class="nav-link nav-link-dropdown">buy | sell | rent</a>
              <ul class="nav-dropdown">
                <li><a href="/buy.html" class="nav-dropdown-link">buy</a></li>
                <li><a href="/sell.html" class="nav-dropdown-link">sell</a></li>
                <li><a href="/rent.html" class="nav-dropdown-link">rent</a></li>
              </ul>
            </li>

            <li class="nav-item"><a href="/neighborhoods.html" class="nav-link">neighborhoods</a></li>
            <li class="nav-item"><a href="/contact.html" class="nav-link">contact</a></li>
          </ul>
        </nav>
      </div>

      <!-- Backdrop + panel -->
      <div class="menu-backdrop" data-menu-close aria-hidden="true"></div>

      <div class="menu-panel" role="dialog" aria-modal="true" aria-label="Site menu">
        <div class="menu-panel-inner">
          <div class="menu-panel-top">
            <div class="menu-panel-title">menu</div>

            <div class="menu-panel-top-right">
              <img
                class="menu-panel-mark"
                src="/assets/img/logo-transparent-lg.png"
                alt="Templeton Real Estate Group"
              />
              <button class="menu-close" type="button" data-menu-close aria-label="Close menu">✕</button>
            </div>
          </div>

          <div class="menu-layout">
            <!-- LEFT: big primary links -->
            <div class="menu-primary" aria-label="Primary menu links">
              <a class="menu-primary-link" href="/buy.html">buy.</a>
              <a class="menu-primary-link" href="/sell.html">sell.</a>
              <a class="menu-primary-link" href="/rent.html">rent.</a>
              <a class="menu-primary-link" href="/neighborhoods.html">neighborhoods.</a>
              <a class="menu-primary-link" href="/partners.html">partners.</a>
              <a class="menu-primary-link" href="/team/">meet the team.</a>
              <a class="menu-primary-link" href="/contact.html">contact us.</a>

              <!-- CTA row (left column) -->
              <div class="menu-cta-row">
                <a class="btn btn-primary" href="/intake.html">start intake</a>
                <a class="btn btn-ghost" href="/contact.html">email our team</a>
              </div>
            </div>

            <!-- RIGHT: grouped subtle links -->
            <div class="menu-secondary" aria-label="Secondary menu links">
              <div class="menu-col">
                <div class="menu-col-title">Work with us</div>
                <a class="menu-link" href="/buy-process.html">Buy Process</a>
                <a class="menu-link" href="/sell-process.html">Sell Process</a>
                <a class="menu-link" href="/rent-process.html">Rent Process</a>
                <a class="menu-link" href="/intake.html">New Client Intake</a>
              </div>

              <div class="menu-col">
                <div class="menu-col-title">Company</div>
                <a class="menu-link" href="/about.html">Our Story</a>
                <a class="menu-link" href="/reviews.html">Client Reviews</a>
                <a class="menu-link" href="/partners.html">Partners</a>
                <a class="menu-link" href="/contact.html">Contact</a>
              </div>

              <div class="menu-col">
                <div class="menu-col-title">Explore</div>
                <a class="menu-link" href="/">Home</a>
                <a class="menu-link" href="/neighborhoods.html">Neighborhood Guides</a>
                <a class="menu-link" href="/partners.html">Partner Referrals</a>
                <a class="menu-link" href="/reviews.html">Testimonials</a>
              </div>

              <!-- Spacer box (invisible) to force a perfect 2x2 grid -->
              <div class="menu-col menu-col--spacer" aria-hidden="true"></div>
            </div>
          </div>

          <!-- Big corner favicon / mark (we'll position with CSS) -->
          <img
            src="/assets/img/icons/favicon-1500x1500-tran.png"
            alt=""
            aria-hidden="true"
            class="menu-corner-mark"
          />
        </div>
      </div>
    </header>

    <main class="main">
      <!-- HERO -->
      <section class="hero">
        <div class="hero-inner">
          <div class="hero-label">Tools</div>
          <h1 class="hero-title">seller net proceeds calculator</h1>
          <p class="hero-subtitle">
            A quick estimate for commissions, transfer taxes, and common seller-side fees.
            Add your payoff to see a ballpark net after payoff.
          </p>

          <div class="btn-row">
            <a class="btn btn-ghost" href="/tools/buy-closing-cost-calculator.html">buyer calculator</a>
            <a class="btn btn-primary" href="/intake.html">start intake</a>
          </div>
        </div>
      </section>

      <!-- CONTENT -->
      <section class="section">
        <div class="container">
          <div class="calc-grid">
            <!-- Inputs -->
            <div class="calc-card">
              <h2>Inputs</h2>

              <form class="calc-form" id="sellerCalc" novalidate>
                <div class="calc-field">
                  <label for="salePrice">Sale price</label>
                  <input id="salePrice" inputmode="decimal" value="500000" />
                </div>

                <div class="calc-field">
                  <label for="mortgagePayoff">Mortgage payoff (optional)</label>
                  <input id="mortgagePayoff" inputmode="decimal" value="0" />
                </div>

                <div class="calc-field">
                  <label for="closingDate">Estimated closing date</label>
                  <input id="closingDate" type="date" />
                </div>

                <div class="calc-field">
                  <label for="commissionPct">Total commission (%)</label>
                  <input id="commissionPct" inputmode="decimal" value="5" />
                </div>

                <div class="calc-field">
                  <label for="attorneyFee">Attorney fee (flat)</label>
                  <input id="attorneyFee" inputmode="decimal" value="500" />
                </div>

                <div class="calc-field">
                  <label for="annualTax">Annual property taxes (estimate)</label>
                  <input id="annualTax" inputmode="decimal" value="9000" />
                </div>

                <div class="calc-field">
                  <label for="taxProrationPct">Tax proration factor (%)</label>
                  <input id="taxProrationPct" inputmode="decimal" value="5" />
                </div>

                <!-- AUTO tax proration credit (hidden until relevant) -->
                <div class="calc-field calc-span-2 calc-auto-row" id="rowTaxProration">
                  <label for="taxProrationCredit">Tax proration credit to buyer (auto)</label>
                  <input id="taxProrationCredit" inputmode="decimal" value="$0" readonly />
                </div>

                <div class="calc-field">
                  <label for="monthlyHoa">Monthly HOA (if applicable)</label>
                  <input id="monthlyHoa" inputmode="decimal" value="0" />
                </div>

                <div class="calc-field">
                  <label for="hoaPaidThrough">HOA paid through</label>
                  <select id="hoaPaidThrough">
                    <option value="month_end" selected>End of month</option>
                    <option value="close_date">Only through closing date</option>
                  </select>
                </div>

                <!-- AUTO HOA proration credit (hidden until relevant) -->
                <div class="calc-field calc-span-2 calc-auto-row" id="rowHoaProration">
                  <label for="hoaProrationCredit">HOA proration credit to seller (auto)</label>
                  <input id="hoaProrationCredit" inputmode="decimal" value="$0" readonly />
                </div>

                <div class="calc-field calc-span-2">
                  <label for="locationMode">Transfer tax location</label>
                  <select id="locationMode">
                    <option value="chicago" selected>Chicago</option>
                    <option value="cook_non_chicago">Cook (non-Chicago)</option>
                    <option value="none">No transfer tax</option>
                  </select>
                </div>

                <div class="calc-field">
                  <label for="customLocalTax">Custom local transfer tax ($/1,000)</label>
                  <input id="customLocalTax" inputmode="decimal" value="0" />
                </div>

                <!-- AUTO transfer tax total (hidden until relevant) -->
                <div class="calc-field calc-auto-row" id="rowTransferTax">
                  <label for="transferTaxTotal">Estimated transfer taxes (auto)</label>
                  <input id="transferTaxTotal" inputmode="decimal" value="$0" readonly />
                </div>

                <div class="calc-field">
                  <label for="titleSellerFees">Title/escrow seller fees (est.)</label>
                  <input id="titleSellerFees" inputmode="decimal" value="450" />
                </div>

                <!-- Advanced accordion -->
                <div class="calc-field calc-span-2">
                  <details class="calc-accordion">
                    <summary>advanced options (optional)</summary>
                    <div class="accordion-body">

                      <div class="calc-field">
                        <label for="recordingFees">Recording / release fees (est.)</label>
                        <input id="recordingFees" inputmode="decimal" value="0" />
                      </div>

                      <div class="calc-field">
                        <label for="hoaDocsFees">HOA docs / move-out / paid assessment (est.)</label>
                        <input id="hoaDocsFees" inputmode="decimal" value="0" />
                      </div>

                      <div class="calc-field">
                        <label for="sellerCredits">Seller credits (repairs / concessions)</label>
                        <input id="sellerCredits" inputmode="decimal" value="0" />
                      </div>

                      <div class="calc-field">
                        <label for="otherSellerCosts">Other seller costs</label>
                        <input id="otherSellerCosts" inputmode="decimal" value="0" />
                      </div>

                      <div class="calc-field accordion-span-2">
                        <div class="calc-help">
                          Optional fields let you account for common “extras” that can show up on a settlement statement.
                          Leave blank if you’re not sure.
                        </div>
                      </div>

                    </div>
                  </details>
                </div>

                <div class="calc-actions calc-span-2">
                  <button class="btn btn-primary" type="button" id="calcBtn">calculate</button>
                  <button class="btn btn-ghost" type="button" id="resetBtn">reset</button>
                </div>
              </form>
            </div>

            <!-- Results -->
            <div class="calc-card">
              <h2>Results</h2>

              <div class="calc-results">
                <div class="calc-kpi">
                  <strong>Estimated seller costs</strong>
                  <span id="sellerCosts">$—</span>
                </div>
                <div class="calc-kpi">
                  <strong>Estimated net (before payoff)</strong>
                  <span id="netBeforePayoff">$—</span>
                </div>
                <div class="calc-kpi">
                  <strong>Estimated net (after payoff)</strong>
                  <span id="netAfterPayoff">$—</span>
                </div>
              </div>

              <table class="calc-table" aria-label="Seller cost breakdown">
                <thead>
                  <tr>
                    <th>Category</th>
                    <th>Estimate</th>
                  </tr>
                </thead>
                <tbody id="breakdown"></tbody>
              </table>

              <div class="calc-disclaimer">
                This tool provides a rough estimate for planning purposes only. Actual costs and credits vary by municipality, proration method,
                title company, lien payoffs, HOA requirements, and negotiated terms. Templeton Real Estate Group, LLC and Keller Williams ONEChicago
                do not guarantee figures shown here and are not responsible for decisions made based on this estimate.
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- FOOTER (exact) -->
    <footer class="site-footer">
      <div class="site-footer-inner">

        <div class="footer-brand">
          templeton real estate group · chicago, il
        </div>

        <div class="footer-links">
          <a href="/about.html">About</a> ·
          <a href="/neighborhoods.html">Neighborhoods</a> ·
          <a href="/reviews.html">Reviews</a> ·
          <a href="/contact.html">Contact</a>
        </div>

        <div>
          &copy; <span id="year"></span> Templeton Real Estate Group, LLC.
        </div>

      </div>
    </footer>

  </div>

  <script>
    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();

    // ---------- Parsing + formatting helpers ----------
    function parseNumber(raw) {
      const s = String(raw ?? "").trim();
      if (!s) return 0;
      const cleaned = s.replace(/[^0-9.\-]/g, "");
      const n = Number(cleaned);
      return Number.isFinite(n) ? n : 0;
    }

    function moneyFmt(n) {
      const rounded = Math.round(n || 0);
      return rounded.toLocaleString(undefined, {
        style: "currency",
        currency: "USD",
        maximumFractionDigits: 0
      });
    }

    function percentFmt(n) {
      const rounded = Math.round((n || 0) * 1000) / 1000;
      return String(rounded).replace(/\.0+$/, "").replace(/(\.\d*[1-9])0+$/, "$1");
    }

    function percentDisplay(n) {
      // "5" -> "5%"
      return `${percentFmt(n)}%`;
    }

    function getVal(id) {
      const el = document.getElementById(id);
      return parseNumber(el ? el.value : 0);
    }

    function getDateVal(id) {
      const el = document.getElementById(id);
      const v = el ? String(el.value || "").trim() : "";
      if (!v) return null;
      const d = new Date(v + "T12:00:00");
      return Number.isFinite(d.getTime()) ? d : null;
    }

    function endOfMonth(d) {
      return new Date(d.getFullYear(), d.getMonth() + 1, 0, 12);
    }

    function daysBetween(a, b) {
      const ms = (b.getTime() - a.getTime());
      return Math.max(0, Math.round(ms / 86400000));
    }

    function dayOfYear(d) {
      const start = new Date(d.getFullYear(), 0, 1, 12);
      return daysBetween(start, d) + 1;
    }

    function daysInYear(d) {
      const y = d.getFullYear();
      const start = new Date(y, 0, 1, 12);
      const next = new Date(y + 1, 0, 1, 12);
      return Math.round((next - start) / 86400000);
    }

    function setReasonableDefaultDate() {
      const el = document.getElementById("closingDate");
      if (!el) return;
      if (String(el.value || "").trim()) return;
      const today = new Date();
      const guess = new Date(today.getFullYear(), today.getMonth() + 1, 15);
      const yyyy = guess.getFullYear();
      const mm = String(guess.getMonth() + 1).padStart(2, "0");
      const dd = String(guess.getDate()).padStart(2, "0");
      el.value = `${yyyy}-${mm}-${dd}`;
    }

    function isMeaningfullyNonZero(n) {
      return Math.abs(Math.round(n || 0)) >= 1;
    }

    function setRowVisible(rowId, shouldShow) {
      const row = document.getElementById(rowId);
      if (!row) return;

      if (shouldShow) {
        row.style.display = "block";
        requestAnimationFrame(() => row.classList.add("is-visible"));
      } else {
        row.classList.remove("is-visible");
        window.setTimeout(() => {
          if (!row.classList.contains("is-visible")) row.style.display = "none";
        }, 200);
      }
    }

    // ---------- Defaults + formatting groups ----------
    const currencyFieldIds = [
      "salePrice",
      "mortgagePayoff",
      "attorneyFee",
      "annualTax",
      "monthlyHoa",
      "titleSellerFees",
      "recordingFees",
      "hoaDocsFees",
      "sellerCredits",
      "otherSellerCosts"
    ];

    // Note: these are percent-style inputs that should show a trailing "%"
    const percentPrettyFieldIds = [
      "commissionPct",
      "taxProrationPct"
    ];

    // Numeric (not percent) but we still clean-format on blur
    const numericFieldIds = [
      "customLocalTax" // $ per 1,000
    ];

    const defaults = {
      salePrice: "500000",
      mortgagePayoff: "0",
      closingDate: "",
      commissionPct: "5",
      attorneyFee: "500",
      annualTax: "9000",
      taxProrationPct: "5",
      monthlyHoa: "0",
      hoaPaidThrough: "month_end",
      locationMode: "chicago",
      customLocalTax: "0",
      titleSellerFees: "450",
      recordingFees: "0",
      hoaDocsFees: "0",
      sellerCredits: "0",
      otherSellerCosts: "0"
    };

    function resetDefaults() {
      for (const [k, v] of Object.entries(defaults)) {
        const el = document.getElementById(k);
        if (!el) continue;
        el.value = v;
      }
      setReasonableDefaultDate();
      formatAll();
      calculate();
    }

    function transferTaxRates(mode) {
      // Rates in $ per $1,000 of sale price
      if (mode === "chicago") return { city: 7.50, county: 0.50, state: 1.00 };
      if (mode === "cook_non_chicago") return { city: 0.00, county: 0.50, state: 1.00 };
      return { city: 0.00, county: 0.00, state: 0.00 };
    }

    // Illinois proration conventions vary by contract; this is a common planning model:
    // seller credit ~= (annual taxes * (1 + factor%)) * portion of year elapsed at closing.
    function computeSellerTaxProration(closingDate, annualTax, factorPct) {
      if (!closingDate || annualTax <= 0) return 0;
      const doy = dayOfYear(closingDate);
      const daysSellerOwes = Math.max(0, doy - 1);
      const diy = daysInYear(closingDate);
      const factor = 1 + (Math.max(factorPct, 0) / 100);
      return Math.max(0, (annualTax * factor) * (daysSellerOwes / diy));
    }

    // HOA proration credit to seller if seller paid through month-end.
    function computeHoaProrationCreditToSeller(closingDate, monthlyHoa, paidThrough) {
      if (!closingDate || monthlyHoa <= 0) return 0;
      if (paidThrough !== "month_end") return 0;

      const eom = endOfMonth(closingDate);
      const nextDay = new Date(closingDate.getFullYear(), closingDate.getMonth(), closingDate.getDate() + 1, 12);
      const endPlusOne = new Date(eom.getFullYear(), eom.getMonth(), eom.getDate() + 1, 12);

      const daysRemaining = daysBetween(nextDay, endPlusOne);
      const daysInMonth = eom.getDate();
      return (monthlyHoa / daysInMonth) * Math.max(0, daysRemaining);
    }

    function calculate() {
      const price = getVal("salePrice");
      const payoff = getVal("mortgagePayoff");
      const closingDate = getDateVal("closingDate");

      const commissionPct = Math.max(getVal("commissionPct"), 0);
      const commission = price * (commissionPct / 100);

      const attorney = getVal("attorneyFee");
      const titleSellerFees = getVal("titleSellerFees");

      // Advanced
      const recordingFees = Math.max(getVal("recordingFees"), 0);
      const hoaDocsFees = Math.max(getVal("hoaDocsFees"), 0);
      const sellerCredits = Math.max(getVal("sellerCredits"), 0);
      const otherSellerCosts = Math.max(getVal("otherSellerCosts"), 0);

      // Transfer taxes (auto)
      const mode = document.getElementById("locationMode").value;
      const rates = transferTaxRates(mode);
      const customLocal = Math.max(getVal("customLocalTax"), 0);

      const cityTax = price / 1000 * rates.city;
      const countyTax = price / 1000 * rates.county;
      const stateTax = price / 1000 * rates.state;
      const customTax = price / 1000 * customLocal;

      const transferTaxesTotal = Math.max(0, cityTax + countyTax + stateTax + customTax);

      // Tax proration (auto only)
      const annualTax = Math.max(getVal("annualTax"), 0);
      const taxProrationPct = Math.max(getVal("taxProrationPct"), 0);
      const taxProrationCredit = computeSellerTaxProration(closingDate, annualTax, taxProrationPct);

      // HOA proration (auto only)
      const monthlyHoa = Math.max(getVal("monthlyHoa"), 0);
      const hoaPaidThrough = document.getElementById("hoaPaidThrough").value;
      const hoaCredit = computeHoaProrationCreditToSeller(closingDate, monthlyHoa, hoaPaidThrough);

      // Update readonly displays (always update values even if hidden)
      const taxEl = document.getElementById("taxProrationCredit");
      const hoaEl = document.getElementById("hoaProrationCredit");
      const taxTotEl = document.getElementById("transferTaxTotal");
      if (taxEl) taxEl.value = moneyFmt(taxProrationCredit);
      if (hoaEl) hoaEl.value = moneyFmt(hoaCredit);
      if (taxTotEl) taxTotEl.value = moneyFmt(transferTaxesTotal);

      // Show/hide auto rows only when relevant
      setRowVisible("rowTaxProration", isMeaningfullyNonZero(taxProrationCredit));
      setRowVisible("rowHoaProration", isMeaningfullyNonZero(hoaCredit));
      setRowVisible("rowTransferTax", isMeaningfullyNonZero(transferTaxesTotal));

      // Seller costs: proration credit is a COST to seller; HOA proration is a CREDIT (reduces costs)
      const sellerCosts =
        commission +
        attorney +
        titleSellerFees +
        recordingFees +
        hoaDocsFees +
        sellerCredits +
        otherSellerCosts +
        taxProrationCredit +
        transferTaxesTotal
        - hoaCredit;

      const netBeforePayoff = price - sellerCosts;
      const netAfterPayoff = netBeforePayoff - payoff;

      document.getElementById("sellerCosts").textContent = moneyFmt(sellerCosts);
      document.getElementById("netBeforePayoff").textContent = moneyFmt(netBeforePayoff);
      document.getElementById("netAfterPayoff").textContent = moneyFmt(netAfterPayoff);

      const rows = [
        ["Commission", commission],
        ["Attorney fee", attorney],
        ["Title/escrow seller fees (est.)", titleSellerFees],
        ["Recording / release fees (est.)", recordingFees],
        ["HOA docs / move-out / paid assessment (est.)", hoaDocsFees],
        ["Seller credits (repairs / concessions)", sellerCredits],
        ["Other seller costs", otherSellerCosts],
        ["Tax proration credit to buyer (auto)", taxProrationCredit],
        ["Transfer taxes (auto)", transferTaxesTotal],
        ["HOA proration credit to seller (auto, if applicable)", -hoaCredit]
      ];

      const tbody = document.getElementById("breakdown");
      tbody.innerHTML = "";
      for (const [label, val] of rows) {
        if (Math.round(val) === 0) continue;
        const tr = document.createElement("tr");
        const td1 = document.createElement("td");
        const td2 = document.createElement("td");
        td1.textContent = label;
        td2.textContent = moneyFmt(val);
        tr.appendChild(td1);
        tr.appendChild(td2);
        tbody.appendChild(tr);
      }
    }

    // ---------- Live recalc (debounced) ----------
    function bindLiveRecalc() {
      const form = document.getElementById("sellerCalc");
      if (!form) return;

      let t = null;
      const schedule = () => {
        window.clearTimeout(t);
        t = window.setTimeout(calculate, 120);
      };

      form.querySelectorAll("input, select, details").forEach((el) => {
        el.addEventListener("input", schedule);
        el.addEventListener("change", schedule);
        el.addEventListener("toggle", schedule);
      });
    }

    // ---------- Formatting on blur ----------
    function formatCurrencyField(el) {
      const n = parseNumber(el.value);
      el.value = moneyFmt(n);
    }

    function formatPercentPrettyField(el) {
      // Accept "5", "5%", etc. and display as "5%"
      const n = parseNumber(el.value);
      el.value = percentDisplay(n);
    }

    function formatNumericField(el) {
      const n = parseNumber(el.value);
      el.value = percentFmt(n);
    }

    function bindBlurFormatting() {
      currencyFieldIds.forEach((id) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener("blur", () => formatCurrencyField(el));
        el.addEventListener("focus", () => el.select());
      });

      percentPrettyFieldIds.forEach((id) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener("blur", () => formatPercentPrettyField(el));
        el.addEventListener("focus", () => el.select());
      });

      numericFieldIds.forEach((id) => {
        const el = document.getElementById(id);
        if (!el) return;
        el.addEventListener("blur", () => formatNumericField(el));
        el.addEventListener("focus", () => el.select());
      });
    }

    function formatAll() {
      currencyFieldIds.forEach((id) => {
        const el = document.getElementById(id);
        if (el) formatCurrencyField(el);
      });

      percentPrettyFieldIds.forEach((id) => {
        const el = document.getElementById(id);
        if (el) formatPercentPrettyField(el);
      });

      numericFieldIds.forEach((id) => {
        const el = document.getElementById(id);
        if (el) formatNumericField(el);
      });
    }

    document.getElementById("calcBtn").addEventListener("click", calculate);
    document.getElementById("resetBtn").addEventListener("click", resetDefaults);

    setReasonableDefaultDate();
    bindLiveRecalc();
    bindBlurFormatting();
    formatAll();
    calculate();
  </script>
</body>
</html>
